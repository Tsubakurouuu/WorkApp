<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--Mapperとxmlのマッピング-->
<mapper namespace="com.example.repository.WorkMapper">
	<!--マッピング定義(勤怠)-->
	<resultMap id="work" type="com.example.model.Work">
		<id column="id" property="id"/>
		<result column="user_id" property="userId"/>
		<result column="year" property="year"/>
		<result column="month" property="month"/>
		<result column="date" property="date"/>
		<result column="attendance_hour" property="attendanceHour"/>
		<result column="attendance_minute" property="attendanceMinute"/>
		<result column="leaving_hour" property="leavingHour"/>
		<result column="leaving_minute" property="leavingMinute"/>
		<result column="rest_hour" property="restHour"/>
		<result column="rest_minute" property="restMinute"/>
		<result column="working_time_hour" property="workingTimeHour"/>
		<result column="working_time_minute" property="workingTimeMinute"/>
		<result column="over_time_hour" property="overTimeHour"/>
		<result column="over_time_minute" property="overTimeMinute"/>
		<result column="work_status" property="workStatus"/>
		<association property="mUser" resultMap="user" columnPrefix="user_"/>
		<!--<association property="requestForm" resultMap="request_form" columnPrefix="request_form_"/>-->
	</resultMap>
	<!--マッピング定義(ユーザー)-->
	<resultMap id="user" type="com.example.model.MUser">
		<id column="id" property="id"/>
		<result column="user_id" property="userId"/>
		<result column="password" property="password"/>
		<result column="last_name" property="lastName"/>
		<result column="first_name" property="firstName"/>
		<result column="birthday" property="birthday"/>
		<result column="role" property="role"/>
	</resultMap>
	<!--マッピング定義(申請フォーム)-->
	<!--
	<resultMap id="request_form" type="com.example.model.RequestForm">
		<id column="id" property="id"/>
		<result column="work_id" property="workId"/>
		<result column="year" property="year"/>
		<result column="month" property="month"/>
		<result column="date" property="date"/>
		<result column="work_status" property="workStatus"/>
		<result column="attendance_hour" property="attendanceHour"/>
		<result column="attendance_minute" property="attendanceMinute"/>
		<result column="leaving_hour" property="leavingHour"/>
		<result column="leaving_minute" property="leavingMinute"/>
		<result column="rest_hour" property="restHour"/>
		<result column="rest_minute" property="restMinute"/>
		<result column="comment" property="comment"/>
	</resultMap>
	-->
	<!--出勤時間登録-->
	<insert id="insertAttendance">
		insert into work(user_id, year, month, date, attendance_hour, attendance_minute)
		values (#{userId}, #{year}, #{month}, #{date}, #{attendanceHour}, #{attendanceMinute})
	</insert>
	<!--退勤時間登録（更新）-->
	<update id="updateLeaving">
		update work set
		leaving_hour = #{work.leavingHour},
		leaving_minute = #{work.leavingMinute},
		rest_hour = #{work.restHour},
		rest_minute = #{work.restMinute},
		working_time_hour = #{work.workingTimeHour},
		working_time_minute = #{work.workingTimeMinute},
		over_time_hour = #{work.overTimeHour},
		over_time_minute = #{work.overTimeMinute}
		where
		user_id = #{work.userId} and
		year = #{work.year} and
		month = #{work.month} and
		date = #{work.date}
	</update>
	<!--勤怠情報取得-->
	<select id="selectWork" resultMap="work">
		select * from work where id = #{id}
		<!--
		select
			work.id,
			work.user_id,
			work.year,
			work.month,
			work.date,
			work.attendance_hour,
			work.attendance_minute,
			work.leaving_hour,
			work.leaving_minute,
			work.rest_hour,
			work.rest_minute,
			work.working_time_hour,
			work.working_time_minute,
			work.over_time_hour,
			work.over_time_minute,
			work.work_status,
			request_form.id as request_form_id,
			request_form.work_id as request_form_work_id,
			request_form.year as request_form_year,
			request_form.month as request_form_month,
			request_form.date as request_form_date,
			request_form.work_status as request_form_work_status,
			request_form.attendance_hour as request_form_attendance_hour,
			request_form.attendance_minute as request_form_attendance_minute,
			request_form.leaving_hour as request_form_leaving_hour,
			request_form.leaving_minute as request_form_leaving_minute,
			request_form.rest_hour as request_form_rest_hour,
			request_form.rest_minute as request_form_rest_minute,
			request_form.comment as request_form_comment
		from 
			work left join request_form on work.id = request_form.work_id
		where
			work.id = #{id}
		-->
	</select>
	<!--勤怠情報一覧取得（ユーザーごと）-->
	<select id="selectWorkList" resultType="Work">
		select
			work.id,
			work.user_id,
			work.year,
			work.month,
			work.date,
			work.attendance_hour,
			work.attendance_minute,
			work.leaving_hour,
			work.leaving_minute,
			work.rest_hour,
			work.rest_minute,
			work.working_time_hour,
			work.working_time_minute,
			work.over_time_hour,
			work.over_time_minute,
			work.work_status,
			m_user.id as user_id,
			m_user.user_id as user_user_id,
			m_user.password as user_password,
			m_user.first_name as user_first_name,
			m_user.last_name as user_last_name,
			m_user.birthday as user_birthday,
			m_user.role as user_role
		from 
			work left join m_user on work.user_id = m_user.id
		where
			work.user_id = #{userId}
	</select>
	<!--勤怠情報更新-->
	<update id="updateWork">
		update
			work
		set
			attendance_hour = #{work.attendanceHour},
			attendance_minute = #{work.attendanceMinute},
			leaving_hour = #{work.leavingHour},
			leaving_minute = #{work.leavingMinute},
			rest_hour = #{work.restHour},
			rest_minute = #{work.restMinute},
			working_time_hour = #{work.workingTimeHour},
			working_time_minute = #{work.workingTimeMinute},
			over_time_hour = #{work.overTimeHour},
			over_time_minute = #{work.overTimeMinute},
			work_status = #{work.workStatus}
		where
			id = #{work.id} 
			
	</update>
</mapper>